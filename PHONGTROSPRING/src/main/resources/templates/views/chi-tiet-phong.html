<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Chi Tiết Phòng</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/assets/css/chitietphong.css">
    <style>
        /* Base styles */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header styles */
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .room-status {
            padding: 5px 10px;
            border-radius: 4px;
        }

        .status-empty {
            background-color: #28a745;
            color: white;
        }

        .status-occupied {
            background-color: #dc3545;
            color: white;
        }

        /* Button styles */
        .action-buttons {
            margin-bottom: 20px;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }

        .btn-add {
            background-color: #007bff;
            color: white;
        }

        .btn-edit {
            background-color: #ffc107;
            color: black;
        }

        .btn-delete {
            background-color: #dc3545;
            color: white;
        }

        .btn-back {
            background-color: #6c757d;
            color: white;
            text-decoration: none;
        }

        /* Table styles */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .table th, .table td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .table th {
            background-color: #f8f9fa;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 5px;
            max-width: 500px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .error-message {
            color: #dc3545;
            font-size: 0.9em;
        }

        /* Initial readings modal specific styles */
        .input-group {
            margin-bottom: 15px;
        }.input-group label {
            display: inline-block;
            width: 150px;
            margin-right: 10px;
        }

        .input-group input {
            width: 150px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .input-group .unit {
            margin-left: 10px;
            color: #666;
        }

        .modal-actions {
            text-align: right;
            margin-top: 20px;
        }

        /* Alert styles */
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        


/* Tab styles */
        .tabs {
            margin-top: 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: -1px;
        }

        .tab-button {
            padding: 10px 20px;
            background: none;
            border: 1px solid transparent;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-size: 16px;
            color: #6c757d;
        }

        .tab-button.active {
            color: #007bff;
            border-color: #dee2e6 #dee2e6 #fff;
            background-color: #fff;
        }

        .tab-content {
            display: none;
            padding: 20px 0;
        }

        .tab-content.active {
            display: block;
        }

        /* Room info styles */
        .room-info {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .info-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-item {
            background-color: white;
            padding: 15px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .info-item h4 {
            margin: 0 0 10px 0;
            color: #007bff;
        }

        .info-value {
            font-size: 1.2em;
            color: #333;
        }

        .info-unit {
            color: #6c757d;
            font-size: 0.9em;
        }
    </style>
</head><body>
    <div class="container">
        <!-- Header section -->
        <div class="header-section">
            <h2>Chi Tiết Phòng: <span th:text="${room.tenPhong}"></span></h2>
            <div class="room-status" th:classappend="${room.status == 'Trống' ? 'status-empty' : 'status-occupied'}">
                Trạng thái: <span th:text="${room.status}"></span>
            </div>
        </div>

        <!-- Alert messages -->
        <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <!-- Action buttons -->
        <div class="action-buttons">
            <button class="btn btn-add" onclick="openAddTenantModal()">Thêm Người Thuê</button>
            <button class="btn btn-add" onclick="openInitialReadingsModal()">Thiết lập chỉ số ban đầu</button>
            <a th:href="@{/phong/{id}(id=${room.listings.itemId})}" class="btn btn-back">Quay Lại</a>            
        </div>

        <!-- Tenants list -->
        <!-- <div class="tenant-list">
            <h3>Danh Sách Người Thuê</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Họ Tên</th>
                        <th>CCCD</th>
                        <th>Số Điện Thoại</th>
                        <th>Thao Tác</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="tenant : ${tenants}">
                        <td th:text="${tenant.hoTen}"></td>
                        <td th:text="${tenant.soCCCD}"></td>
                        <td th:text="${tenant.sDT}"></td>
                        <td>
                            <button class="btn btn-edit" th:onclick="'openEditModal(' + ${tenant.id} + ')'">Sửa</button>
                            <button class="btn btn-delete" th:onclick="'openDeleteModal(' + ${tenant.id} + ')'">Xóa</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div> -->

                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="openTab('tenants')">Danh Sách Người Thuê</button>
                        <button class="tab-button" onclick="openTab('info')">Thông Tin Phòng</button>
                    </div>
                    <!-- Tab Danh sách người thuê -->
                    <div id="tenants" class="tab-content active">
                        <div class="tenant-list">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Họ Tên</th>
                                        <th>CCCD</th>
                                        <th>Số Điện Thoại</th>
                                        <th>Thao Tác</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="tenant : ${tenants}">
                                        <td th:text="${tenant.hoTen}"></td>
                                        <td th:text="${tenant.soCCCD}"></td>
                                        <td th:text="${tenant.sDT}"></td>
                                        <td>
                                            <button class="btn btn-edit" th:onclick="'openEditModal(' + ${tenant.id} + ')'">Sửa</button>
                                            <button class="btn btn-delete" th:onclick="'openDeleteModal(' + ${tenant.id} + ')'">Xóa</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                                <!-- Tab Thông tin phòng -->
            <div id="info" class="tab-content">
                <div class="room-info">
                    <h3>Chỉ Số Ban Đầu</h3>
                    <div class="info-group">
                        <div class="info-item">
                            <h4>Chỉ Số Điện</h4>
                            <div class="info-value">
                                <span >0</span>
                                <span class="info-unit">kWh</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <h4>Chỉ Số Nước</h4>
                            <div class="info-value">
                                <span>0</span>
                                <span class="info-unit">m³</span>
                            </div>
                        </div>
                    </div>

                    <h3>Đơn Giá Dịch Vụ</h3>
                    <div class="info-group">
                        <div class="info-item">
                            <h4>Đơn Giá Điện</h4>
                            <div class="info-value">
                                <span>0</span>
                                <span class="info-unit">VNĐ/kWh</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <h4>Đơn Giá Nước</h4>
                            <div class="info-value">
                                <span >0</span>
                                <span class="info-unit">VNĐ/m³</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <h4>Phí Rác</h4>
                            <div class="info-value">
                                <span >0</span>
                                <span class="info-unit">VNĐ/tháng</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <h4>Phí Wifi</h4>
                            <div class="info-value">
                                <span >0</span>
                                <span class="info-unit">VNĐ/tháng</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        <!-- Modal thêm người thuê -->
        <div id="addModal" class="modal">
            <div class="modal-content">
                <h3>Thêm Người Thuê Mới</h3>
                <form th:action="@{/phong/{id}/them-nguoi-thue(id=${room.id})}" method="post">
                    <div class="form-group">
                        <label>Họ và tên:</label>
                        <input type="text" name="hoTen" required>
                    </div>
                    
                    <div class="form-group">
                        <label>CCCD:</label>
                        <input type="text" name="soCCCD" required minlength="12" maxlength="12"
                               pattern="[0-9]{12}" title="CCCD phải có 12 số"
                               oninput="validateCCCD(this)">
                        <span class="error-message" id="cccdError"></span></div>
                    
                    <div class="form-group">
                        <label>Số điện thoại:</label>
                        <input type="text" name="sDT" required minlength="10" maxlength="10"
                               pattern="[0-9]{10}" title="Số điện thoại phải có 10 số"
                               oninput="validateSDT(this)">
                        <span class="error-message" id="sdtError"></span>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" onclick="closeModal('addModal')" class="btn btn-secondary">Hủy</button>
                        <button type="submit" class="btn btn-primary" id="addSubmitBtn">Thêm</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal thiết lập chỉ số ban đầu -->
        <div id="initialReadingsModal" class="modal">
            <div class="modal-content">
                <h3>Thiết Lập Chỉ Số Ban Đầu</h3>
                <form th:action="@{/phong/{id}/thiet-lap-chi-so(id=${room.id})}" method="post">
                    <!-- Chỉ số ban đầu -->
                    <div class="form-group">
                        <h4>Chỉ Số Ban Đầu</h4>
                        <div class="input-group">
                            <label>Số điện ban đầu:</label>
                            <input type="number" name="soDienBanDau" required min="0" step="1"
                                   oninput="validateNumber(this)"
                                   class="form-control">
                            <span class="unit">kWh</span>
                        </div>
                        
                        <div class="input-group">
                            <label>Số nước ban đầu:</label>
                            <input type="number" name="soNuocBanDau" required min="0" step="1"
                                   oninput="validateNumber(this)"
                                   class="form-control">
                            <span class="unit">m³</span>
                        </div>
                    </div>

                    <!-- Đơn giá -->
                    <div class="form-group">
                        <h4>Đơn Giá Dịch Vụ</h4>
                        <div class="input-group">
                            <label>Đơn giá điện:</label>
                            <input type="number" name="donGiaDien" required min="0"
                                   oninput="validateNumber(this)"
                                   class="form-control">
                            <span class="unit">VNĐ/kWh</span>
                        </div><div class="input-group">
                            <label>Đơn giá nước:</label>
                            <input type="number" name="donGiaNuoc" required min="0"
                                   oninput="validateNumber(this)"
                                   class="form-control">
                            <span class="unit">VNĐ/m³</span>
                        </div>

                        <div class="input-group">
                            <label>Phí rác:</label>
                            <input type="number" name="phiRac" required min="0"
                                   oninput="validateNumber(this)"
                                   class="form-control">
                            <span class="unit">VNĐ/tháng</span>
                        </div>

                        <div class="input-group">
                            <label>Phí wifi:</label>
                            <input type="number" name="phiWifi" required min="0"
                                   oninput="validateNumber(this)"
                                   class="form-control">
                            <span class="unit">VNĐ/tháng</span>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" onclick="closeModal('initialReadingsModal')" class="btn btn-secondary">Hủy</button>
                        <button type="submit" class="btn btn-primary">Lưu</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit tenant modal -->
        <div th:each="tenant : ${tenants}" th:id="'editModal' + ${tenant.id}" class="modal">
            <div class="modal-content">
                <h3>Sửa Thông Tin Người Thuê</h3>
                <form th:action="@{/nguoi-thue/{id}/edit(id=${tenant.id})}" method="post">
                    <div class="form-group">
                        <label>Họ và tên:</label>
                        <input type="text" name="hoTen" th:value="${tenant.hoTen}" required>
                    </div>
                    <div class="form-group">
                        <label>CCCD:</label>
                        <input type="text" name="soCCCD" th:value="${tenant.soCCCD}" required
                               minlength="12" maxlength="12" th:data-original="${tenant.soCCCD}"
                               oninput="validateEditCCCD(this)">
                        <span class="error-message" th:id="'cccdError' + ${tenant.id}"></span>
                    </div>
                    <div class="form-group">
                        <label>Số điện thoại:</label>
                        <input type="text" name="sDT" th:value="${tenant.sDT}" required
                               minlength="10" maxlength="10" th:data-original="${tenant.sDT}"
                               oninput="validateEditSDT(this)"><span class="error-message" th:id="'sdtError' + ${tenant.id}"></span>
                    </div>
                    <div class="modal-actions">
                        <button type="button" th:onclick="'closeModal(\'editModal' + ${tenant.id} + '\')'" 
                                class="btn btn-secondary">Hủy</button>
                        <button type="submit" class="btn btn-primary" th:id="'editSubmitBtn' + ${tenant.id}">Lưu</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Delete tenant modal -->
        <div th:each="tenant : ${tenants}" th:id="'deleteModal' + ${tenant.id}" class="modal">
            <div class="modal-content">
                <h3>Xác nhận xóa</h3>
                <p>Bạn có chắc chắn muốn xóa người thuê <strong th:text="${tenant.hoTen}"></strong>?</p>
                <form th:action="@{/nguoi-thue/{id}/delete(id=${tenant.id})}" method="post">
                    <div class="modal-actions">
                        <button type="button" th:onclick="'closeModal(\'deleteModal' + ${tenant.id} + '\')'"
                                class="btn btn-secondary">Hủy</button>
                        <button type="submit" class="btn btn-danger">Xóa</button>
                    </div>
                </form>
            </div>
        </div>
    </div><script>
        // Modal functions
        function openAddTenantModal() {
            document.getElementById('addModal').style.display = 'block';
        }

        function openInitialReadingsModal() {
            document.getElementById('initialReadingsModal').style.display = 'block';
        }

        function openEditModal(id) {
            document.getElementById('editModal' + id).style.display = 'block';
        }

        function openDeleteModal(id) {
            document.getElementById('deleteModal' + id).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Validate CCCD input
        function validateCCCD(input) {
            const cccdError = document.getElementById('cccdError');
            const submitBtn = document.getElementById('addSubmitBtn');
            
            if (input.value.length !== 12) {
                cccdError.textContent = 'CCCD phải có đúng 12 số';
                submitBtn.disabled = true;
            } else if (!/^\d+$/.test(input.value)) {
                cccdError.textContent = 'CCCD chỉ được chứa số';
                submitBtn.disabled = true;
            } else {
                cccdError.textContent = '';
                submitBtn.disabled = false;
            }
        }

        // Validate SDT input
        function validateSDT(input) {
            const sdtError = document.getElementById('sdtError');
            const submitBtn = document.getElementById('addSubmitBtn');
            
            if (input.value.length !== 10) {
                sdtError.textContent = 'Số điện thoại phải có đúng 10 số';
                submitBtn.disabled = true;
            } else if (!/^\d+$/.test(input.value)) {
                sdtError.textContent = 'Số điện thoại chỉ được chứa số';
                submitBtn.disabled = true;
            } else {
                sdtError.textContent = '';
                submitBtn.disabled = false;
            }
        }

        // Validate edit CCCD
        function validateEditCCCD(input) {
            const id = input.closest('form').action.split('/').pop();
            const cccdError = document.getElementById('cccdError' + id);
            const submitBtn = document.getElementById('editSubmitBtn' + id);
            
            if (input.value.length !== 12) {
                cccdError.textContent = 'CCCD phải có đúng 12 số';
                submitBtn.disabled = true;
            } else if (!/^\d+$/.test(input.value)) {
                cccdError.textContent = 'CCCD chỉ được chứa số';
                submitBtn.disabled = true;
            } else {
                cccdError.textContent = '';
                submitBtn.disabled = false;
            }
        }

        // Validate edit SDT
        function validateEditSDT(input) {
            const id = input.closest('form').action.split('/').pop();const sdtError = document.getElementById('sdtError' + id);
            const submitBtn = document.getElementById('editSubmitBtn' + id);
            
            if (input.value.length !== 10) {
                sdtError.textContent = 'Số điện thoại phải có đúng 10 số';
                submitBtn.disabled = true;
            } else if (!/^\d+$/.test(input.value)) {
                sdtError.textContent = 'Số điện thoại chỉ được chứa số';
                submitBtn.disabled = true;
            } else {
                sdtError.textContent = '';
                submitBtn.disabled = false;
            }
        }

        // Validate number inputs for initial readings
        function validateNumber(input) {
            if (input.value < 0) {
                input.value = 0;
            }
            
            // Remove any decimal places for whole number fields
            if (input.name === 'soDienBanDau' || input.name === 'soNuocBanDau') {
                input.value = Math.floor(input.value);
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        }
    </script>

<script>
    // Existing JavaScript ...

    // Tab functionality
    function openTab(tabName) {
        // Hide all tab contents
        const tabContents = document.getElementsByClassName('tab-content');
        for (let content of tabContents) {
            content.classList.remove('active');
        }

        // Deactivate all tab buttons
        const tabButtons = document.getElementsByClassName('tab-button');
        for (let button of tabButtons) {
            button.classList.remove('active');
        }

        // Show selected tab content and activate button
        document.getElementById(tabName).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // After saving initial readings, switch to info tab
    function afterSaveInitialReadings() {
        closeModal('initialReadingsModal');
        openTab('info');
    }

    // Update form submit handler
    document.querySelector('#initialReadingsModal form').addEventListener('submit', function(e) {
        e.preventDefault();
        // Here you would normally submit the form data
        // After successful submission:
        afterSaveInitialReadings();
    });
</script>
</body>
</html>