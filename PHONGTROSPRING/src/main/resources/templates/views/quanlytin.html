<!DOCTYPE html>
<html>
<head>


<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quản lý tin</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" type="text/css" href="/assets/css/naptien.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/assets/css/quanlytin.css">

<link rel="stylesheet" type="text/css" href="/assets/css/header.css">
<link rel="stylesheet" type="text/css" href="/assets/css/footer.css">
<script src="/assets/js/header.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
	rel="stylesheet">
<script>
function loadTime() {
    const goithoigian = document.getElementById("goitime").value;
    const soNgay = document.getElementById("songay");
    soNgay.innerHTML='<option value="">-- Chọn thời gian --</option>'
    if (goithoigian) {
        fetch(`/dataget/${goithoigian}`) // Gửi GET request
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json(); // Parse JSON
            })
            .then(data => {                
                data.forEach(time => {
                    const optionss = document.createElement("option");
                    optionss.value = time.time; // Đặt value là districtId
                    optionss.text = time.time +" "+time.bientime; // Hiển thị tên quận/huyện
                    soNgay.appendChild(optionss);
                });
            })
            .catch(error => console.error("Error:", error));
    } else {
    	soNgay.innerHTML = '<option value="">-- Chọn thời gian --</option>'; // Reset nếu không chọn thành phố
    }
}
</script>
</head>
<body>
	<div th:replace="views/header-footer/header"></div>
	<div class="container">

		<div class="left-column" th:replace="views/header-footer/left_menu"></div>
		<div style="display: flex; flex-direction: column; width: 100%">
			<div style="display: flex; justify-content: center;">
				<h1>Quản lý tin đăng</h1>
				<div class="boder"></div>
			</div>
			<form th:action="@{/quanlytin}" method="get" class="search_form">
				<div>
					<input type="text" placeholder="Tìm theo mã hoặc tiêu đề"
						class="search" name="valuesearch" id="searchtext"
						onchange="this.form.submit()">
				</div>
				<div>
					<select class="search" name="valueloaitin" id="searchloaitin"
						onchange="this.form.submit()">
						<option value="">Lọc theo loại tin</option>
						<option value="0">Tin miễn phí</option>
						<option value="1">Tin thường</option>
						<option value="2">Tin VIP 3</option>
						<option value="3">Tin VIP 2</option>
						<option value="4">Tin VIP 1</option>
						<option value="5">Tin VIP nổi bật</option>
					</select>
				</div>
				<div>
					<select class="search" name="valuetrangthai" id="searchtrangthai"
						onchange="this.form.submit()">
						<option value="">Lọc theo trạng thái</option>
						<option value="Đã duyệt">Đã duyệt</option>
						<option value="Chờ duyệt">Chờ duyệt</option>
						<option value="Ẩn tin">Tin ẩn</option>
					</select>
				</div>
			</form>
			<div class="main-content">
				<table>
					<tr>
						<th>Mã tin</th>
						<th>Tiêu đề</th>
						<th>Giá</th>
						<th>Ngày bắt đầu</th>
						<th>Ngày hết hạn</th>
						<th>Trạng thái</th>
						<th>Actions</th>
					</tr>
					<tr th:each="listing : ${listtingsss}">
						<td th:text="${listing.itemId}"></td>
						<td th:text="${listing.title}"></td>
						<td th:text="${listing.price}"></td>
						<td th:text="${listing.createdAt}"></td>
						<td th:text="${listing.expiryDate}"></td>
						<td th:text="${listing.status}"></td>
						<td>
							<div th:if="${listing.status} == 'Ẩn tin'">
								<div class="btn">
									<a th:href="@{/quanlytin/danglai/{id}(id=${listing.itemId})}"
										th:onclick="'return confirm(\'Bạn có chắc chắn muốn đăng lại tin?\')'"><button>Đăng
											lại</button></a>
								</div>
							</div>
							<div th:if="${listing.status} != 'Ẩn tin'">
								<div class="btn">
									<a th:href="@{quanlytin/update/{id}(id=${listing.itemId})}"><button>Sửa
											tin</button></a>
								</div>
								<div class="btn">
									<button type="button" class="btn btn-primary"
										data-bs-toggle="modal" data-bs-target="#exampleModal"
										th:onclick="'return confirm(\'Bạn có chắc chắn muốn gia hạn tin?\')'">Gia
										hạn tin</button>
								</div>
								<div class="btn">
									<a th:href="@{/quanlytin/hide/{id}(id=${listing.itemId})}"
										th:onclick="'return confirm(\'Bạn có chắc chắn muốn ẩn tin?\')'"><button>Ẩn
											tin</button></a>
								</div>
							</div>

						</td>
						<div class="modal fade" id="exampleModal" tabindex="-1"
					aria-labelledby="exampleModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="exampleModalLabel">Chọn thời
									gian</h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal"
									aria-label="Close"></button>
							</div>
							<div class="modal-body">
								<form method="get" th:action="@{/quanlytin/giahan/{id}(id=${listing.itemId})}" >
									<div class="mb-3">
										<label for="select1" class="form-label">Chọn gói thời
											gian muốn gia hạn thêm</label> <select class="form-select"
											name="goitime" id="goitime" onchange="loadTime()" required>
											<option>Chọn gói thời gian</option>
											<option value="ngay">Đăng theo ngày</option>
											<option value="tuan">Đăng theo tuần</option>
											<option value="thang">Đăng theo tháng</option>
										</select>
									</div>
									<div class="mb-3">
										<label for="select2" class="form-label">Chọn thời gian</label> <select class="form-select" name="songay" id="songay" required>
										</select>
									</div>
								
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary"
									data-bs-dismiss="modal">Close</button>
								<button type="submit" class="btn btn-primary">Hoàn thành</button>
							</div>
							</form>
						</div>
					</div>
				</div>
					</tr>
				</table>
			</div>
				<div th:if="${successMessage}" class="alert alert-success" role="alert">
		<span th:text="${successMessage}"></span>
	</div>
	<div th:if="${errorMessage}" class="alert alert-danger" role="alert">
		<span th:text="${errorMessage}"></span>
	</div>
			<div class="pagination">
				<a th:if="${listtingsss.hasPrevious()}"
					th:href="@{/quanlytin(page=${listtingsss.number - 1},valuesearch=${valuesearch}, valueloaitin=${valueloaitin}, valuetrangthai=${valuetrangthai})}">«
					Previous</a> <span>Page <span
					th:text="${listtingsss.number + 1}">1</span> of <span
					th:text="${listtingsss.totalPages}">1</span>
				</span> <a th:if="${listtingsss.hasNext()}"
					th:href="@{/quanlytin(page=${listtingsss.number + 1},valuesearch=${valuesearch}, valueloaitin=${valueloaitin}, valuetrangthai=${valuetrangthai})}">Next
					»</a>
			</div>
		</div>
	</div>
</body>

</html>